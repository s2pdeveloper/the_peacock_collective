"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[216],{3216:(ot,h,a)=>{a.r(h),a.d(h,{InvoiceModule:()=>nt});var u=a(6814),t=a(5879),p=a(7285),T=a(6676),A=a.n(T),d=a(1076),f=a(3780),b=a(4087),Z=a(2425),y=a(6593),U=a(342),_=a(7741),s=a(95);function q(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",38),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,l=t.oxw();return t.KtG(l.navigateTo("/default/invoice/form",n._id,"update"))}),t._UZ(1,"i",39),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.Q6J("disabled","Created"!==e.status)}}function x(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",40),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,l=t.oxw();return t.KtG(l.updateStatus(n._id,"Generated","update"))}),t._UZ(1,"i",41),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.Q6J("disabled","Generated"==e.status)}}function N(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",42),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,l=t.oxw();return t.KtG(l.updateStatus(n._id,"Created","reset"))}),t._UZ(1,"i",43),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.Q6J("disabled","Created"==e.status)}}function w(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr")(1,"td",27),t._uU(2),t.qZA(),t.TgZ(3,"td",27),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"td",28)(7,"span",29),t._uU(8),t.qZA()(),t.TgZ(9,"td",30),t._uU(10),t.qZA(),t.TgZ(11,"td",27),t._uU(12),t.qZA(),t.TgZ(13,"td",30)(14,"span"),t._uU(15),t.ALo(16,"titlecase"),t.qZA()(),t.TgZ(17,"td",30),t.YNc(18,q,2,1,"button",31),t.YNc(19,x,2,1,"button",32),t.YNc(20,N,2,1,"button",33),t.TgZ(21,"button",34),t.NdJ("click",function(){const l=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.navigateToInvoice("/invoice",l))}),t._UZ(22,"i",35),t.qZA(),t.TgZ(23,"button",36),t.NdJ("click",function(){const l=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.sendMessage(l))}),t._UZ(24,"i",37),t.qZA()()()}if(2&o){const e=c.$implicit,i=t.oxw();t.xp6(2),t.Oqu(e.invoiceNo),t.xp6(2),t.hij(" ",t.xi3(5,15,e.createdAt,"dd-MM-yyyy hh:mm a")," "),t.xp6(3),t.Q6J("ngbTooltip",e.name),t.xp6(1),t.hij(" ",e.customerName,""),t.xp6(2),t.Oqu(e.mobile),t.xp6(2),t.hij(" ",e.netValue," "),t.xp6(2),t.Gre("badge rounded-pill  text-bg-","Generated"==e.status?"success":"warning"," px-2"),t.xp6(1),t.hij(" ",t.lcZ(16,18,e.status),""),t.xp6(3),t.Q6J("ngIf","report"!=i.isReportTab),t.xp6(1),t.Q6J("ngIf","report"!=i.isReportTab),t.xp6(1),t.Q6J("ngIf","report"!=i.isReportTab),t.xp6(1),t.Q6J("disabled","Generated"!=e.status),t.xp6(2),t.Q6J("disabled","Generated"!=e.status)}}function M(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",44)(1,"button",45),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.KtG(l.dismiss("Cross click"))}),t.qZA()(),t.TgZ(2,"div",46)(3,"h3",47),t._uU(4),t.ALo(5,"uppercase"),t.qZA(),t.TgZ(6,"h4",48),t._uU(7," Are you sure you want to Delete ? "),t.qZA()(),t.TgZ(8,"div",49)(9,"button",50),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.delete(n.selectedRow._id))}),t._uU(10," YES "),t.qZA(),t.TgZ(11,"button",51),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.KtG(l.dismiss("Cross click"))}),t._uU(12," NO "),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(4),t.AsE(" ",e.selectedRow.code," - ",t.lcZ(5,2,e.selectedRow.name)," ")}}let S=(()=>{class o{constructor(e,i,n,l,r,m,g){this.router=e,this.service=i,this.spinner=n,this.toastService=l,this.actRoute=r,this.title=m,this.clipboard=g,this.page=1,this.pageSize=25,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.products=[],this.statusArray=["Created","Generated"],this.isReportTab="",this.modalService=(0,t.f3M)(p.FF)}updateUser(e){}ngOnInit(){this.actRoute.queryParams.subscribe(e=>{e.id?(this.isReportTab=e.id,this.getAll(["Generated"])):(this.isReportTab="",this.getAll(this.statusArray))})}onChangePage(e){e>0&&(this.page=e),this.getAll(this.statusArray)}searchFn(){(this.search.toString().length>=1||0==this.search.toString().length)&&this.getAll(this.statusArray)}open(e,i){this.selectedRow=e,this.modalService.open(i,{centered:!0})}add(){this.router.navigate(["/default/product/product-form"])}delete(e){this.spinner.show(),this.service.deleteById(e).subscribe(i=>{this.spinner.hide(),this.toastService.success(i.message),this.modalService.dismissAll(),this.getAll(this.statusArray)})}updateStatus(e,i,n){this.spinner.show(),this.service.updateStatus(e,{status:i,action:n}).subscribe(r=>{this.spinner.hide(),this.toastService.success(r.message),this.modalService.dismissAll(),"reset"==n?this.router.navigate(["/default/invoice/form"],{queryParams:{id:e,action:"update"}}):this.getAll(this.statusArray)})}getAll(e){this.spinner.show(),this.service.getAll({page:this.page,pageSize:this.pageSize,search:this.search,statusArray:e}).subscribe(n=>{this.spinner.hide(),this.products=n.rows,this.collection=n.count})}navigateToInvoice(e,i){this.spinner.show(),this.service.getInvoiceDetails(i._id).subscribe(n=>{this.spinner.hide(),n?this.router.navigate([e],{state:{data:JSON.stringify(n)}}):this.toastService.warning("No invoice exists")}),this.title.setTitle(`${i.invoiceNo}_${i.customer.mobile}_${A()().format("D MMM, YYYY")}`)}navigateTo(e,i,n){this.router.navigate([e],i?{queryParams:{id:i,action:n}}:{queryParams:{action:n}})}sendMessage(e){const n=`Hi ${e.customerName}!  Thank You for Shopping with Jhumka Planet. Your invoice is now ready. Do visit us again \u{1f642}.\nRegards\nRucha, Jhumka Planet`,l=`https://wa.me/91${e.customer.mobile}?text=${encodeURIComponent(n)}`;this.clipboard.copy(n),window.open(l,"_blank")}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(d.F0),t.Y36(f.q),t.Y36(b.V),t.Y36(Z._W),t.Y36(d.gz),t.Y36(y.Dx),t.Y36(U.TU))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-list"]],decls:42,vars:5,consts:[[1,"table-container"],[1,"card","table-card"],[1,"card-title"],[1,"card-header"],[1,"row","justify-content-between"],[1,"col-4"],[1,"input-icons"],[1,"input-group","input-group-sm"],["type","search","aria-label","Small","placeholder","Search","aria-describedby","inputGroup-sizing-sm",1,"form-control",3,"ngModel","ngModelChange","input"],[1,"input-group-append"],["id","inputGroup-sizing-sm",1,"input-group-text","h-100"],[1,"ti","ti-search"],[1,"col-md-4","col-3","text-right"],[1,"btn","add-btn",3,"click"],[1,"ti","ti-plus","me-1"],[1,"card-body","p-3"],[1,"table-responsive"],[1,"table","table-hover","table-bordered"],[1,"thead"],[1,"table-secondary"],["scope","col"],["scope","col",1,"text-start"],["scope","col",1,"mx-auto","text-center"],[1,"tbody","mt-3"],[4,"ngFor","ngForOf"],[3,"page","pageSize","collection","pageChange","pageSizeChange","collectionChange","myOutput"],["deleteModal",""],["scope","row"],["scope","row",1,"text-start"],["placement","top",3,"ngbTooltip"],["scope","row",1,"text-center"],["class","btn action-btn btn-sm me-2","ngbTooltip","Update",3,"disabled","click",4,"ngIf"],["class","btn action-btn btn-sm me-2","ngbTooltip","Generated",3,"disabled","click",4,"ngIf"],["class","btn action-btn btn-sm me-2","ngbTooltip","Reset",3,"disabled","click",4,"ngIf"],["ngbTooltip","Print",1,"btn","action-btn","btn-sm","me-2",3,"disabled","click"],[1,"fas","fa-eye"],["ngbTooltip","Print",1,"btn","action-btn","btn-sm",3,"disabled","click"],[1,"fa-brands","fa-whatsapp"],["ngbTooltip","Update",1,"btn","action-btn","btn-sm","me-2",3,"disabled","click"],[1,"ti","ti-edit-circle"],["ngbTooltip","Generated",1,"btn","action-btn","btn-sm","me-2",3,"disabled","click"],[1,"fas","fa-file-alt"],["ngbTooltip","Reset",1,"btn","action-btn","btn-sm","me-2",3,"disabled","click"],[1,"fas","fa-rotate-left"],[1,"modal-header","border-0"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","border-0"],["id","modal-basic-title",1,"modal-title","text-center","text-primary"],["id","modal-basic-title",1,"modal-title","text-center"],[1,"modal-footer","justify-content-center","border-0"],[1,"btn","px-4","btn-outline-danger",3,"click"],["type","button",1,"btn","px-4","btn-outline-primary",3,"click"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),t._uU(4,"Invoice List"),t.qZA()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"input",8),t.NdJ("ngModelChange",function(r){return n.search=r})("input",function(){return n.searchFn()}),t.qZA(),t.TgZ(11,"div",9)(12,"span",10),t._UZ(13,"i",11),t.qZA()()()()(),t.TgZ(14,"div",12)(15,"button",13),t.NdJ("click",function(){return n.navigateTo("/default/invoice/form",null,"create")}),t._UZ(16,"i",14),t._uU(17," Add Invoice "),t.qZA()()()(),t.TgZ(18,"div",15)(19,"div",16)(20,"table",17)(21,"thead",18)(22,"tr",19)(23,"th",20),t._uU(24,"Invoice no."),t.qZA(),t.TgZ(25,"th",20),t._uU(26,"Invoice Date"),t.qZA(),t.TgZ(27,"th",21),t._uU(28,"Customer Name"),t.qZA(),t.TgZ(29,"th",20),t._uU(30,"Mobile"),t.qZA(),t.TgZ(31,"th",20),t._uU(32,"Total Price"),t.qZA(),t.TgZ(33,"th",20),t._uU(34,"Status"),t.qZA(),t.TgZ(35,"th",22),t._uU(36,"Action"),t.qZA()()(),t.TgZ(37,"tbody",23),t.YNc(38,w,25,20,"tr",24),t.qZA()()(),t.TgZ(39,"app-custom-pagination",25),t.NdJ("pageChange",function(r){return n.page=r})("pageSizeChange",function(r){return n.pageSize=r})("collectionChange",function(r){return n.collection=r})("myOutput",function(){return n.onChangePage(n.page)}),t.qZA()()()(),t.YNc(40,M,13,4,"ng-template",null,26,t.W1O)),2&i&&(t.xp6(10),t.Q6J("ngModel",n.search),t.xp6(28),t.Q6J("ngForOf",n.products),t.xp6(1),t.Q6J("page",n.page)("pageSize",n.pageSize)("collection",n.collection))},dependencies:[u.sg,u.O5,_.W,s.Fj,s.JJ,s.On,p._L,u.gd,u.rS,u.uU]})}return o})();var F=a(485),C=a(6857),P=a(503);let k=(()=>{class o{constructor(e,i,n,l,r,m){this.router=e,this.spinner=i,this.validationService=n,this.customerService=l,this.toastService=r,this.modelService=m,this.submitted=!1,this.userId=null,this.customerForm=new s.cw({_id:new s.NI(null),customerName:new s.NI(null,[s.kI.required]),mobile:new s.NI(null,[s.kI.required]),whatsUp:new s.NI(null),email:new s.NI(null),DOB:new s.NI(null),currency:new s.NI("INR"),address:new s.cw({line1:new s.NI(null),line2:new s.NI(null),city:new s.NI(null),state:new s.NI(null),country:new s.NI("India"),pinCode:new s.NI(null)})}),this.FORM_ERRORS=[{message:"Name is Required",key:"customerName"},{message:"Mobile is Required",key:"mobile"}]}get f(){return this.customerForm.controls}ngOnInit(){}navigateTo(e){this.router.navigate([e])}submit(){if(this.submitted=!0,this.validationService.checkErrors(this.customerForm,this.FORM_ERRORS))return;let e=this.customerForm.value;e.role="Admin",this.create(e)}create(e){this.spinner.show(),this.customerService.create(e).subscribe(i=>{this.spinner.hide(),this.toastService.success(i.message),this.modelService.close(i.customerDetails)})}reset(){this.customerForm.reset()}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(d.F0),t.Y36(b.V),t.Y36(C.R),t.Y36(P.v),t.Y36(F.k),t.Y36(p.Kz))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-customer-model"]],decls:86,vars:1,consts:[[1,"container-fluid","p-0"],[1,"row"],[1,"col-12"],[1,"card"],[1,"card-header","p-3","d-flex","justify-content-between"],[1,"btn","btn-white","border","border-0",3,"click"],[1,"fa","fa-md","text-primary","fa-xmark","align-self-center","shadow","p-1","mb-2","bg-white","rounded"],[1,"card-body","p-4"],[3,"formGroup"],[1,"col-md-6","mb-2"],[1,"form-label"],[1,"text-danger"],["formControlName","customerName","placeholder","Full Name","type","text",1,"form-control"],["formControlName","mobile","placeholder","Mobile","type","text",1,"form-control"],["formControlName","email","placeholder","Email","type","text",1,"form-control"],["formControlName","whatsUp","placeholder","AlternateMobile","type","text",1,"form-control"],[1,"col-md-6"],["formControlName","DOB","placeholder","DOB","type","date",1,"form-control"],["formControlName","currency",1,"form-control"],["selected","","disabled","","value","null"],["value","INR"],["value","USD"],[1,"my-3"],[1,""],["formGroupName","address",1,"row"],[1,"col-md-4","mb-2"],["formControlName","line1","placeholder","line1","type","text",1,"form-control"],["formControlName","line2","placeholder","line2","type","text",1,"form-control"],["formControlName","city","placeholder","city","type","text",1,"form-control"],[1,"col-md-4"],["formControlName","state","placeholder","state","type","text",1,"form-control"],["formControlName","country","placeholder","country","type","text",1,"form-control"],["formControlName","pinCode","placeholder","pinCode","type","number",1,"form-control"],[1,"d-flex","justify-content-center"],["type","submit",1,"btn","reset-btn","btn-primary","mx-2",3,"click"],[1,"fa-solid","fa-arrows-rotate","me-2"],["type","submit",1,"btn","submit-btn","btn-success",3,"click"],[1,"fa-solid","fa-plus","me-2"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3"),t._uU(6,"Create Customer"),t.qZA(),t.TgZ(7,"button",5),t.NdJ("click",function(){return n.modelService.dismiss()}),t._UZ(8,"i",6),t.qZA()(),t.TgZ(9,"div",7)(10,"form",8)(11,"div",1)(12,"div",9)(13,"label",10),t._uU(14," Name "),t.TgZ(15,"span",11),t._uU(16,"*"),t.qZA()(),t._UZ(17,"input",12)(18,"div"),t.qZA(),t.TgZ(19,"div",9)(20,"label",10),t._uU(21," Mobile Number "),t.TgZ(22,"span",11),t._uU(23,"*"),t.qZA()(),t._UZ(24,"input",13),t.qZA()(),t.TgZ(25,"div",1)(26,"div",9)(27,"label",10),t._uU(28," Email "),t.qZA(),t._UZ(29,"input",14),t.qZA(),t.TgZ(30,"div",9)(31,"label",10),t._uU(32," Alternate Mobile "),t.qZA(),t._UZ(33,"input",15),t.qZA(),t.TgZ(34,"div",16)(35,"label",10),t._uU(36," DOB "),t.qZA(),t._UZ(37,"input",17),t.qZA(),t.TgZ(38,"div",16)(39,"label",10),t._uU(40," Currency "),t.qZA(),t.TgZ(41,"select",18)(42,"option",19),t._uU(43," Select Currency "),t.qZA(),t.TgZ(44,"option",20),t._uU(45,"INR"),t.qZA(),t.TgZ(46,"option",21),t._uU(47,"USD"),t.qZA()()()(),t._UZ(48,"hr",22),t.TgZ(49,"h5",23),t._uU(50,"Address details"),t.qZA(),t.TgZ(51,"div",24)(52,"div",25)(53,"label",10),t._uU(54," Line 1 "),t.qZA(),t._UZ(55,"input",26),t.qZA(),t.TgZ(56,"div",25)(57,"label",10),t._uU(58," Line 2 "),t.qZA(),t._UZ(59,"input",27),t.qZA(),t.TgZ(60,"div",25)(61,"label",10),t._uU(62," City "),t.qZA(),t._UZ(63,"input",28),t.qZA(),t.TgZ(64,"div",29)(65,"label",10),t._uU(66," State "),t.qZA(),t._UZ(67,"input",30),t.qZA(),t.TgZ(68,"div",29)(69,"label",10),t._uU(70," Country "),t.qZA(),t._UZ(71,"input",31),t.qZA(),t.TgZ(72,"div",29)(73,"label",10),t._uU(74," Pin Code "),t.qZA(),t._UZ(75,"input",32),t.qZA()(),t._UZ(76,"hr",22),t.TgZ(77,"div",1)(78,"div",2)(79,"div",33)(80,"button",34),t.NdJ("click",function(){return n.reset()}),t._UZ(81,"i",35),t._uU(82," Reset "),t.qZA(),t.TgZ(83,"button",36),t.NdJ("click",function(){return n.submit()}),t._UZ(84,"i",37),t._uU(85," Save "),t.qZA()()()()()()()()()()),2&i&&(t.xp6(10),t.Q6J("formGroup",n.customerForm))},dependencies:[s._Y,s.YN,s.Kr,s.Fj,s.wV,s.EJ,s.JJ,s.JL,s.sg,s.u,s.x0]})}return o})();var I=a(1998);function J(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr")(1,"td",24)(2,"input",25),t.NdJ("ngModelChange",function(n){const r=t.CHM(e).$implicit;return t.KtG(r.isChecked=n)}),t.qZA()(),t.TgZ(3,"td",26),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA()()}if(2&o){const e=c.$implicit;t.xp6(2),t.Q6J("ngModel",e.isChecked),t.xp6(2),t.AsE(" ",e.productCode," - ",t.lcZ(5,5,e.productName)," "),t.xp6(3),t.Oqu(e.balanceQuantity),t.xp6(2),t.Oqu(e.salePrice)}}let O=(()=>{class o{constructor(e){this.activeModal=e,this.sendData=new t.vpe,this.saleProducts=[],this.matchingProducts=[],this.page=1,this.pageSize=25,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.selectedProducts=null,this.fileName="",this.url=null,this.file=null}ngOnInit(){this.collection=this.saleProducts.length;for(const e of this.saleProducts)e.isChecked=this.matchingProducts.some(i=>i.productId===e.productId)}onChangePage(e){e>0&&(this.page=e)}searchFn(){}passDataToParent(){this.activeModal.close(this.saleProducts.filter(e=>e.isChecked).map(e=>{let{saleRates:i,...n}=e;return n}))}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(p.Kz))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-product-model"]],inputs:{saleProducts:"saleProducts",matchingProducts:"matchingProducts"},outputs:{sendData:"sendData"},decls:34,vars:12,consts:[[1,"table-container","pb-0","mt-0"],[1,"card","table-card","m-0"],[1,"card-title","d-flex","justify-content-between"],["type","submit",1,"btn","btn-primary",3,"click"],[1,"card-header"],[1,"row","justify-content-between"],[1,"col-4"],[1,"input-icons"],[1,"input-group","input-group-sm"],["type","search","aria-label","Small","placeholder","Search","aria-describedby","inputGroup-sizing-sm",1,"form-control",3,"ngModel","ngModelChange","input"],[1,"input-group-append"],["id","inputGroup-sizing-sm",1,"input-group-text","h-100"],[1,"ti","ti-search"],[1,"card-body","p-3"],[1,"table-responsive"],[1,"table","table-hover","table-bordered"],[1,"thead"],[1,"table-secondary"],["scope","col",1,"mx-auto","text-center"],["scope","col",1,"text-start"],["scope","col"],[1,"tbody","mt-3"],[4,"ngFor","ngForOf"],[3,"page","pageSize","collection","pageChange","pageSizeChange","collectionChange","myOutput"],["scope","row",1,"text-center"],["type","checkbox",1,"form-check-input",3,"ngModel","ngModelChange"],[1,"text-start"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),t._uU(4,"Product List"),t.qZA(),t.TgZ(5,"button",3),t.NdJ("click",function(){return n.passDataToParent()}),t._uU(6," Save & Close "),t.qZA()(),t.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"input",9),t.NdJ("ngModelChange",function(r){return n.search=r})("input",function(){return n.searchFn()}),t.qZA(),t.TgZ(13,"div",10)(14,"span",11),t._UZ(15,"i",12),t.qZA()()()()()()(),t.TgZ(16,"div",13)(17,"div",14)(18,"table",15)(19,"thead",16)(20,"tr",17)(21,"th",18),t._uU(22,"Select"),t.qZA(),t.TgZ(23,"th",19),t._uU(24," Product Code - Product Name "),t.qZA(),t.TgZ(25,"th",20),t._uU(26,"Balance Qty"),t.qZA(),t.TgZ(27,"th",20),t._uU(28,"Sale Price"),t.qZA()()(),t.TgZ(29,"tbody",21),t.YNc(30,J,10,7,"tr",22),t.ALo(31,"slice"),t.ALo(32,"searchFi1ter"),t.qZA()()(),t.TgZ(33,"app-custom-pagination",23),t.NdJ("pageChange",function(r){return n.page=r})("pageSizeChange",function(r){return n.pageSize=r})("collectionChange",function(r){return n.collection=r})("myOutput",function(){return n.onChangePage(n.page)}),t.qZA()()()()),2&i&&(t.xp6(12),t.Q6J("ngModel",n.search),t.xp6(18),t.Q6J("ngForOf",t.Dn7(31,5,t.xi3(32,9,n.saleProducts,n.search),(n.page-1)*n.pageSize,(n.page-1)*n.pageSize+n.pageSize)),t.xp6(3),t.Q6J("page",n.page)("pageSize",n.pageSize)("collection",n.collection))},dependencies:[u.sg,s.Fj,s.Wl,s.JJ,s.On,_.W,u.OU,u.rS,I.G]})}return o})();var D=a(9769),R=a(2096),V=a(8672),Y=a(4807);const v=function(){return{standalone:!0}};function z(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",52),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.TgZ(6,"td")(7,"input",53),t.NdJ("ngModelChange",function(n){const r=t.CHM(e).$implicit;return t.KtG(r.salePrice=n)})("input",function(){const l=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.lineValueRate(l))}),t.qZA()(),t.TgZ(8,"td")(9,"input",53),t.NdJ("ngModelChange",function(n){const r=t.CHM(e).$implicit;return t.KtG(r.quantity=n)})("input",function(){const l=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.lineValueRate(l))}),t.qZA()(),t.TgZ(10,"td"),t._uU(11),t.qZA()()}if(2&o){const e=c.$implicit;t.xp6(2),t.Oqu(null==e?null:e.productCode),t.xp6(2),t.Oqu(t.lcZ(5,7,null==e?null:e.productName)),t.xp6(3),t.Q6J("ngModel",e.salePrice)("ngModelOptions",t.DdM(9,v)),t.xp6(2),t.Q6J("ngModel",e.quantity)("ngModelOptions",t.DdM(10,v)),t.xp6(2),t.Oqu(null==e?null:e.totalValue)}}function L(o,c){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",null==e?null:e.discountPercentage,"% ")}}function Q(o,c){if(1&o&&(t._uU(0),t.ALo(1,"currency")),2&o){const e=t.oxw().$implicit;t.hij(" ",t.xi3(1,1,null==e?null:e.discountAmount,"INR")," ")}}function G(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr")(1,"td",64)(2,"input",65),t.NdJ("ngModelChange",function(n){const r=t.CHM(e).$implicit;return t.KtG(r.isApply=n)}),t.qZA()(),t.TgZ(3,"td",64),t._uU(4),t.qZA(),t.TgZ(5,"td",64),t._uU(6),t.qZA(),t.TgZ(7,"td",64),t._uU(8),t.ALo(9,"date"),t.qZA(),t.TgZ(10,"td",64),t.YNc(11,L,2,1,"span",66),t.YNc(12,Q,2,4,"ng-template",null,67,t.W1O),t.qZA()()}if(2&o){const e=c.$implicit,i=t.MAs(13);t.xp6(2),t.Q6J("ngModel",e.isApply),t.xp6(2),t.Oqu(null==e?null:e.couponCode),t.xp6(2),t.Oqu(null==e?null:e.description),t.xp6(2),t.Oqu(t.lcZ(9,6,null==e?null:e.expirationDate)),t.xp6(3),t.Q6J("ngIf",null==e?null:e.discountPercentage)("ngIfElse",i)}}function $(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",54)(1,"h4",55),t._uU(2,"Apply Coupons"),t.qZA(),t.TgZ(3,"button",56),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.KtG(l.dismiss("Cross click"))}),t.qZA()(),t.TgZ(4,"div",57)(5,"div",58)(6,"table",59)(7,"thead",25)(8,"tr",60)(9,"th",27),t._uU(10,"Select"),t.qZA(),t.TgZ(11,"th",27),t._uU(12,"Coupon Code"),t.qZA(),t.TgZ(13,"th",27),t._uU(14,"Description"),t.qZA(),t.TgZ(15,"th",27),t._uU(16,"Expiration Date"),t.qZA(),t.TgZ(17,"th",27),t._uU(18,"Discount"),t.qZA()()(),t.TgZ(19,"tbody",61),t.YNc(20,G,14,8,"tr",30),t.qZA()()()(),t.TgZ(21,"div",62)(22,"button",63),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.applyCoupon())}),t._uU(23," Apply "),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(20),t.Q6J("ngForOf",e.coupons)}}function E(o,c){1&o&&(t.TgZ(0,"span"),t._uU(1,","),t.qZA())}function j(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.YNc(2,E,2,0,"span",68),t.BQk()),2&o){const e=c.$implicit,i=c.index,n=t.oxw().$implicit;t.xp6(1),t.hij(" ",null==e?null:e.code," "),t.xp6(1),t.Q6J("ngIf",i!=(null==n?null:n.products.length)-1)}}function K(o,c){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",null==e?null:e.discountPercentage,"% ")}}function H(o,c){if(1&o&&(t._uU(0),t.ALo(1,"currency")),2&o){const e=t.oxw().$implicit;t.hij(" ",t.xi3(1,1,null==e?null:e.discountAmount,"INR")," ")}}function B(o,c){if(1&o&&(t.TgZ(0,"tr")(1,"td",64),t._uU(2),t.qZA(),t.TgZ(3,"td",64),t._uU(4),t.qZA(),t.TgZ(5,"td",64),t.YNc(6,j,3,2,"ng-container",30),t.qZA(),t.TgZ(7,"td",64),t._uU(8),t.ALo(9,"date"),t.qZA(),t.TgZ(10,"td",64),t.YNc(11,K,2,1,"span",66),t.YNc(12,H,2,4,"ng-template",null,67,t.W1O),t.qZA()()),2&o){const e=c.$implicit,i=c.index,n=t.MAs(13);t.xp6(2),t.Oqu(i+1),t.xp6(2),t.Oqu(null==e?null:e.title),t.xp6(2),t.Q6J("ngForOf",null==e?null:e.products),t.xp6(2),t.Oqu(t.lcZ(9,6,null==e?null:e.expirationDate)),t.xp6(3),t.Q6J("ngIf",null==e?null:e.discountPercentage)("ngIfElse",n)}}function W(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",54)(1,"h4",55),t._uU(2,"View Offers"),t.qZA(),t.TgZ(3,"button",56),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.KtG(l.dismiss("Cross click"))}),t.qZA()(),t.TgZ(4,"div",57)(5,"div",58)(6,"table",59)(7,"thead",25)(8,"tr",60)(9,"th",27),t._uU(10,"Sr. No."),t.qZA(),t.TgZ(11,"th",27),t._uU(12,"Title"),t.qZA(),t.TgZ(13,"th",27),t._uU(14,"Products"),t.qZA(),t.TgZ(15,"th",27),t._uU(16,"Expiration Date"),t.qZA(),t.TgZ(17,"th",27),t._uU(18,"Discount"),t.qZA()()(),t.TgZ(19,"tbody",61),t.YNc(20,B,14,8,"tr",30),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(20),t.Q6J("ngForOf",e.offers)}}let X=(()=>{class o{constructor(e,i,n,l,r,m,g,it){this.location=e,this.modelService=i,this.service=n,this.validationService=l,this.spinner=r,this.router=m,this.actRoute=g,this.toastService=it,this.page=1,this.pageSize=5,this.collection=0,this.customerOption=[],this.coupons=[],this.offers=[],this.saleProducts=[],this.productDetails=[],this.paymentOptions=[{label:"Cash",value:"Cash"},{label:"UPI",value:"UPI"}],this.submitted=!1,this.isPreview=!1,this.action="create",this.form=new s.cw({_id:new s.p4(null),invoiceNo:new s.p4(null),customerId:new s.p4(null,[s.kI.required]),customerName:new s.p4(null),mobile:new s.p4(null),whatsUp:new s.p4(null),email:new s.p4(null),productDetails:new s.cw([]),gst:new s.p4(0),lineValue:new s.p4(0),totalPrice:new s.p4(0),coupon_offersAmount:new s.p4(0),netValue:new s.p4(0),netPPV:new s.p4(0),paymentType:new s.p4("Cash")}),this.FORM_ERRORS=[{message:"Customer is required",key:"customerId"},{message:"Net Value is required",key:"netValue"}]}get f(){return this.form.controls}ngOnInit(){this.getInitialData()}openCustomerModel(){this.modelService.open(k,{size:"xl"}).result.then(i=>{i&&i._id&&this.getInitialData(i)},i=>{})}openProductModel(){const e=this.modelService.open(O,{size:"xl"});e.componentInstance.saleProducts=this.saleProducts,e.componentInstance.matchingProducts=this.productDetails,e.result.then(i=>{i.forEach(n=>{this.productDetails.some(r=>n._id===r._id)||this.productDetails.push(n)}),this.collection=this.productDetails?.length},i=>{})}getInitialData(e=null){this.service.getAllMasterData({}).subscribe(i=>{this.f.invoiceNo.setValue(i.invoiceNo),this.customerOption=i.customers,this.coupons=i.coupons.map(n=>(n.isApply=!1,n)),this.offers=i.offers,e&&(this.f.customerId.setValue(e._id),this.f.customerName.setValue(e.customerName),this.f.whatsUp.setValue(e.whatsUp),this.f.mobile.setValue(e.mobile),this.f.email.setValue(e.email)),this.saleProducts=i.saleProducts,this.actRoute.queryParams.pipe((0,D.z)(n=>(this.action=n.action,n.id?this.service.getById(n.id):(0,R.of)({})))).subscribe(n=>{n.productDetails&&(this.productDetails=n.productDetails,this.collection=this.productDetails?.length),this.form.patchValue(n)})})}openModel(e){this.modelService.open(e,{ariaLabelledBy:"modal-basic-title",size:"lg"}).result.then(i=>{console.log("`Closed with: ${result}`",`Closed with: ${i}`)},i=>{console.log(`Dismissed ${this.getDismissReason(i)}`)})}getDismissReason(e){return e===p.If.ESC?"by pressing ESC":e===p.If.BACKDROP_CLICK?"by clicking on a backdrop":`with: ${e}`}setCustomerInfo(e){this.f.customerId.setValue(e._id),this.f.customerName.setValue(e.customerName),this.f.whatsUp.setValue(e.whatsUp),this.f.mobile.setValue(e.mobile),this.f.email.setValue(e.email)}onChangePage(e){e>0&&(this.page=e)}lineValueRate(e){let i=this.productDetails.map(l=>l.productId).indexOf(e.productId);this.saleProducts.find(l=>l.productId===e.productId)?.balanceQuantity<e.quantity&&this.toastService.warning("Enter quantity is greater quantity than balanced quantity"),this.productDetails[i].lineValue=Number((e.quantity*e.salePrice).toFixed(2)),this.productDetails[i].PPV=Number((e.quantity*e.salePrice-e.quantity*e.purchaseRate).toFixed(2)),this.productDetails[i].totalValue=this.productDetails[i].lineValue+0*this.productDetails[i].lineValue,this.productDetails[i].appliedGst=0,this.setNetValue()}setNetValue(){this.f.lineValue.setValue(+this.productDetails.reduce((e,i)=>e+i.lineValue,0).toFixed(2)),this.f.netPPV.setValue(+this.productDetails.reduce((e,i)=>e+i.PPV,0).toFixed(2)),this.f.gst.setValue(+this.productDetails.reduce((e,i)=>e+i.appliedGst,0).toFixed(2)),this.f.totalPrice.setValue(this.productDetails.reduce((e,i)=>e+i.totalValue,0).toFixed(2)),this.f.netValue.setValue(+this.f.lineValue.value+ +this.f.gst.value-+this.f.coupon_offersAmount.value)}resetForm(){this.form.reset(),this.getInitialData()}preview(){this.productDetails=this.productDetails.filter(e=>e.quantity>0),this.isPreview=!0}onSubmit(){if(this.submitted=!0,this.validationService.checkErrors(this.form,this.FORM_ERRORS))return;let e=this.form.value;e.productDetails=this.productDetails,e._id?this.update(e._id,e):(delete e._id,this.create(e))}create(e){this.spinner.show(),this.service.create(e).subscribe(i=>{this.spinner.hide(),this.router.navigate(["/default/invoice/list"])})}update(e,i){this.spinner.show(),this.service.updateById(e,i).subscribe(n=>{this.spinner.hide(),this.router.navigate(["/default/invoice/list"])})}back(){this.location.back()}applyCoupon(){this.modelService.dismissAll()}applyDiscount(e){this.f.netValue.setValue(this.f.lineValue.value-e.target.value)}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(u.Ye),t.Y36(p.FF),t.Y36(f.q),t.Y36(C.R),t.Y36(V.t2),t.Y36(d.F0),t.Y36(d.gz),t.Y36(Z._W))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-form"]],decls:96,vars:24,consts:[[1,"card","form-card"],[1,"card-header"],[1,"card-header-items"],[1,"back-btn","btn","btn-primary",3,"click"],[1,"ti","ti-arrow-left","me-1"],[1,"card-body","justify-content-center"],[3,"formGroup"],[1,"row"],[1,"col-12","d-flex","justify-content-between"],[1,"form-label"],["readonly","","formControlName","invoiceNo","type","text",1,"form-control","form-control-sm"],[1,"input-group","d-flex","flex-nowrap"],["placeholder","Select Customer","bindLabel","customerName","bindValue","_id","formControlName","customerId",1,"ng-select-sm",3,"items","clearable","change"],["role","button",1,"input-group-text","bg-danger",3,"click"],[1,"fa","fa-lg","text-white","fa-plus","align-self-center"],["placeholder","Select Mobile","bindLabel","mobile","bindValue","_id","formControlName","customerId",1,"ng-select-sm",3,"items","clearable","multiple","change"],["formControlName","whatsUp","readonly","","type","number",1,"form-control","form-control-sm"],["placeholder","Select Payment Type","bindLabel","label","bindValue","value","formControlName","paymentType",1,"ng-select-sm",3,"items","clearable","multiple"],[1,"my-3"],[1,"row","my-3","justify-content-center"],[1,"col-auto","align-self-end"],[1,"btn","btn-danger",3,"click"],[1,"fa-solid","fa-cart-plus","fa-lg","me-1"],[1,"table-responsive",2,"min-height","35vh"],[1,"table","table-hover","table-sm","table-bordered","text-center"],[1,"thead"],[1,"table-primary"],["scope","col"],["scope","col",1,"text-start"],[1,"tbody"],[4,"ngFor","ngForOf"],[3,"page","pageSize","collection","pageChange","pageSizeChange","collectionChange","myOutput"],[1,"row","justify-content-between"],[1,"col-12","d-flex","pe-0"],[1,"input-group","d-flex"],[1,"input-group-text"],["type","text","readonly","","formControlName","lineValue",1,"form-control","form-control-sm","d-inline","w-25"],[1,"fa","fa-lg","text-primary","fa-minus","mx-2","align-self-center"],["type","number","formControlName","coupon_offersAmount",1,"form-control","form-control-sm","d-inline","w-25",3,"input"],[1,"fa","fa-lg","text-danger","fa-equals","mx-2","align-self-center"],["type","number","formControlName","netValue","readonly","",1,"form-control","form-control-sm","d-inline","w-25"],[1,"mx-2"],[1,"col-12"],[1,"d-flex","justify-content-center"],["type","submit",1,"btn","reset-btn","btn-primary",3,"click"],[1,"fa-solid","fa-arrows-rotate","me-2"],["type","submit",1,"btn","reset-btn","btn-info",3,"click"],[1,"fa-solid","fa-eye","me-2"],["type","submit",1,"btn","submit-btn",3,"disabled","click"],[1,"fa-solid","me-2"],["couponModel",""],["offersModel",""],[1,"text-start"],["type","number",1,"form-control","form-control-sm","d-inline","w-50",3,"ngModel","ngModelOptions","ngModelChange","input"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"table-responsive","text-center"],[1,"table","table-striped"],[1,"table-secondary"],[1,"tbody","mt-3"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"],["scope","row"],["type","checkbox",1,"form-check-input",3,"ngModel","ngModelChange"],[4,"ngIf","ngIfElse"],["elseBlock",""],[4,"ngIf"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),t._uU(4),t.qZA(),t.TgZ(5,"div")(6,"a",3),t.NdJ("click",function(){return n.back()}),t._UZ(7,"i",4),t._uU(8," Back"),t.qZA()()()(),t.TgZ(9,"div",5)(10,"form",6)(11,"div",7)(12,"div",8)(13,"div")(14,"label",9),t._uU(15,"Invoice Number"),t.qZA(),t._UZ(16,"input",10),t.qZA(),t.TgZ(17,"div")(18,"label",9),t._uU(19,"Customer"),t.qZA(),t.TgZ(20,"div",11)(21,"ng-select",12),t.NdJ("change",function(r){return n.setCustomerInfo(r)}),t.qZA(),t.TgZ(22,"span",13),t.NdJ("click",function(){return n.openCustomerModel()}),t._UZ(23,"i",14),t.qZA()()(),t.TgZ(24,"div")(25,"label",9),t._uU(26,"Mobile"),t.qZA(),t.TgZ(27,"ng-select",15),t.NdJ("change",function(r){return n.setCustomerInfo(r)}),t.qZA()(),t.TgZ(28,"div")(29,"label",9),t._uU(30,"Whatsapp"),t.qZA(),t._UZ(31,"input",16),t.qZA(),t.TgZ(32,"div")(33,"label",9),t._uU(34,"Payment Type"),t.qZA(),t._UZ(35,"ng-select",17),t.qZA()()(),t._UZ(36,"hr",18),t.TgZ(37,"div",19)(38,"div",20)(39,"button",21),t.NdJ("click",function(){return n.openProductModel()}),t._UZ(40,"i",22),t._uU(41," Add Product "),t.qZA()()(),t._UZ(42,"hr",18),t.TgZ(43,"div",23)(44,"table",24)(45,"thead",25)(46,"tr",26)(47,"th",27),t._uU(48,"Product Code"),t.qZA(),t.TgZ(49,"th",28),t._uU(50,"Product Name"),t.qZA(),t.TgZ(51,"th",27),t._uU(52,"Sale Price"),t.qZA(),t.TgZ(53,"th",27),t._uU(54,"Quantity"),t.qZA(),t.TgZ(55,"th",27),t._uU(56,"Total Price"),t.qZA()()(),t.TgZ(57,"tbody",29),t.YNc(58,z,12,11,"tr",30),t.ALo(59,"slice"),t.qZA()()(),t.TgZ(60,"app-custom-pagination",31),t.NdJ("pageChange",function(r){return n.page=r})("pageSizeChange",function(r){return n.pageSize=r})("collectionChange",function(r){return n.collection=r})("myOutput",function(){return n.onChangePage(n.page)}),t.qZA(),t._UZ(61,"hr",18),t.TgZ(62,"div",32)(63,"div",33)(64,"div",34)(65,"span",35),t._uU(66,"Total Prize"),t.qZA(),t._UZ(67,"input",36)(68,"i",37),t.qZA(),t.TgZ(69,"div",34)(70,"span",35),t._uU(71,"Discount Rupees"),t.qZA(),t.TgZ(72,"input",38),t.NdJ("input",function(r){return n.applyDiscount(r)}),t.qZA(),t._UZ(73,"i",39),t.qZA(),t.TgZ(74,"div",34)(75,"span",35),t._uU(76,"Net Value"),t.qZA(),t._UZ(77,"input",40)(78,"span",41),t.qZA()()(),t._UZ(79,"hr",18),t.TgZ(80,"div",7)(81,"div",42)(82,"div",43)(83,"button",44),t.NdJ("click",function(){return n.resetForm()}),t._UZ(84,"i",45),t._uU(85," Reset "),t.qZA(),t.TgZ(86,"button",46),t.NdJ("click",function(){return n.preview()}),t._UZ(87,"i",47),t._uU(88," Preview "),t.qZA(),t.TgZ(89,"button",48),t.NdJ("click",function(){return n.onSubmit()}),t._UZ(90,"i",49),t._uU(91),t.qZA()()()()()()(),t.YNc(92,$,24,1,"ng-template",null,50,t.W1O),t.YNc(94,W,21,1,"ng-template",null,51,t.W1O)),2&i&&(t.xp6(4),t.hij("",n.f._id.value?"Update":"Create"," Invoice"),t.xp6(6),t.Q6J("formGroup",n.form),t.xp6(11),t.Q6J("items",n.customerOption)("clearable",!1),t.xp6(6),t.Q6J("items",n.customerOption)("clearable",!1)("multiple",!1),t.xp6(8),t.Q6J("items",n.paymentOptions)("clearable",!1)("multiple",!1),t.xp6(23),t.Q6J("ngForOf",t.Dn7(59,20,n.productDetails,n.page*n.pageSize-n.pageSize,n.page*n.pageSize)),t.xp6(2),t.Q6J("page",n.page)("pageSize",n.pageSize)("collection",n.collection),t.xp6(29),t.Tol(n.f._id.value?"btn-warning":"btn-success"),t.Q6J("disabled",!n.isPreview),t.xp6(1),t.Tol(n.f._id.value?"fa-pen-to-square":"fa-plus"),t.xp6(1),t.hij(" ",n.f._id.value?"Update":"Create"," "))},dependencies:[u.sg,u.O5,_.W,Y.w9,s._Y,s.Fj,s.wV,s.Wl,s.JJ,s.JL,s.On,s.sg,s.u,u.OU,u.rS,u.H9,u.uU]})}return o})();var tt=a(4086);const et=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:S},{path:"form",component:X}];let nt=(()=>{class o{static#t=this.\u0275fac=function(i){return new(i||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[u.ez,_.W,tt.m,d.Bz.forChild(et)]})}return o})()}}]);